<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <span class="text-muted">Manage venues associated with your band</span>
            </div>
            <div>
                <a href="/bands/<%= band.id %>" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Band
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <% if (bandVenues && bandVenues.length > 0) { %>
            <div class="row">
                <% bandVenues.forEach(bandVenue => { %>
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title mb-0">
                                        <a href="/bands/<%= band.id %>/venues/<%= bandVenue.venue.id %>" class="text-decoration-none">
                                            <%= bandVenue.venue.name %>
                                        </a>
                                    </h5>
                                    <button class="btn btn-outline-danger btn-sm remove-venue" 
                                            data-venue-id="<%= bandVenue.venue.id %>"
                                            data-band-id="<%= band.id %>">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                
                                <% if (bandVenue.venue.venueType) { %>
                                    <span class="badge bg-primary mb-2"><%= bandVenue.venue.venueType.name %></span>
                                <% } %>
                                
                                <% if (bandVenue.venue.city && bandVenue.venue.state) { %>
                                    <p class="text-muted mb-2">
                                        <i class="bi bi-geo-alt"></i> <%= bandVenue.venue.city %>, <%= bandVenue.venue.state %>
                                    </p>
                                <% } %>
                                
                                <% if (bandVenue.venue.capacity) { %>
                                    <p class="text-muted mb-2">
                                        <i class="bi bi-people"></i> Capacity: <%= bandVenue.venue.capacity %>
                                    </p>
                                <% } %>
                                
                                <% if (bandVenue.venue.stageLocation) { %>
                                    <p class="text-muted mb-2">
                                        <i class="bi bi-house"></i> Stage: <%= bandVenue.venue.stageLocation.charAt(0).toUpperCase() + bandVenue.venue.stageLocation.slice(1) %>
                                    </p>
                                <% } %>
                                
                                <!-- Contact Information -->
                                <% if (bandVenue.venue.contacts && bandVenue.venue.contacts.length > 0) { %>
                                    <div class="mb-2">
                                        <small class="text-muted">Contact:</small>
                                        <% bandVenue.venue.contacts.slice(0, 2).forEach(contact => { %>
                                            <div class="small">
                                                <i class="<%= contact.contactType.iconClass || 'bi bi-telephone' %>"></i>
                                                <%= contact.value %>
                                                <% if (contact.label) { %>
                                                    <span class="text-muted">(<%= contact.label %>)</span>
                                                <% } %>
                                            </div>
                                        <% }); %>
                                        <% if (bandVenue.venue.contacts.length > 2) { %>
                                            <div class="small text-muted">+<%= bandVenue.venue.contacts.length - 2 %> more</div>
                                        <% } %>
                                    </div>
                                <% } %>
                                
                                <!-- Social Media -->
                                <% if (bandVenue.venue.socials && bandVenue.venue.socials.length > 0) { %>
                                    <div class="mb-2">
                                        <small class="text-muted">Social:</small>
                                        <% bandVenue.venue.socials.slice(0, 2).forEach(social => { %>
                                            <div class="small">
                                                <i class="<%= social.socialType.iconClass || 'bi bi-link' %>"></i>
                                                <a href="<%= social.url || '#' %>" target="_blank" class="text-decoration-none">
                                                    <%= social.handle %>
                                                </a>
                                            </div>
                                        <% }); %>
                                        <% if (bandVenue.venue.socials.length > 2) { %>
                                            <div class="small text-muted">+<%= bandVenue.venue.socials.length - 2 %> more</div>
                                        <% } %>
                                    </div>
                                <% } %>
                                
                                <% if (bandVenue.venue.notes) { %>
                                    <p class="card-text small text-muted">
                                        <%= bandVenue.venue.notes.length > 100 ? 
                                            bandVenue.venue.notes.substring(0, 100) + '...' : 
                                            bandVenue.venue.notes %>
                                    </p>
                                <% } %>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="text-center py-5">
                <i class="bi bi-geo-alt display-1 text-muted"></i>
                <h4 class="mt-3">No Venues Yet</h4>
                <p class="text-muted">Start building your venue network by adding venues to your band.</p>
                <a href="/bands/<%= band.id %>/venue-picker" class="btn btn-primary">
                    <i class="bi bi-plus"></i> Add Your First Venue
                </a>
            </div>
        <% } %>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle venue removal
    document.querySelectorAll('.remove-venue').forEach(button => {
        button.addEventListener('click', function() {
            const venueId = this.dataset.venueId;
            const bandId = this.dataset.bandId;
            
            if (confirm('Are you sure you want to remove this venue from your band?')) {
                fetch(`/bands/${bandId}/venues/${venueId}/remove`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove the card from the DOM
                        this.closest('.col-md-6').remove();
                        
                        // Show success message
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-success alert-dismissible fade show';
                        alert.innerHTML = `
                            ${data.message}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        `;
                        document.querySelector('.row').insertBefore(alert, document.querySelector('.row').firstChild);
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while removing the venue');
                });
            }
        });
    });
});
</script>
