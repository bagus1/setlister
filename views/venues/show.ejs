<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Venue Details</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Address -->
                        <div class="col-md-6 mb-3">
                        <div>
                            <strong>Address:</strong><br>
                            <% if (venue.address) { %>
                                <% if (user) { %>
                                    <span class="venue-field-clickable" 
                                          onclick="editVenueField('address', '<%= venue.address %>', <%= venue.id %>)"
                                          title="Click to suggest edit"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                            <%= venue.address %><br>
                            <% if (venue.city) { %><%= venue.city %><% } %>
                            <% if (venue.city && venue.state) { %>, <% } %>
                            <% if (venue.state) { %><%= venue.state %><% } %>
                            <% if (venue.zipCode) { %> <%= venue.zipCode %><% } %>
                                        <i class="bi bi-pencil ms-2 small"></i>
                                    </span>
                                <% } else { %>
                                    <%= venue.address %><br>
                                    <% if (venue.city) { %><%= venue.city %><% } %>
                                    <% if (venue.city && venue.state) { %>, <% } %>
                                    <% if (venue.state) { %><%= venue.state %><% } %>
                                    <% if (venue.zipCode) { %> <%= venue.zipCode %><% } %>
                                <% } %>
                            <% } else { %>
                                <% if (user) { %>
                                    <span class="text-muted" 
                                          onclick="addVenueField('address', <%= venue.id %>)"
                                          title="Click to add address"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                        Add address
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">Not provided</span>
                                <% } %>
                            <% } %>
                        </div>
                    </div>

                    <!-- City -->
                    <div class="col-md-6 mb-3">
                        <div>
                            <strong>City:</strong><br>
                            <% if (venue.city) { %>
                                <% if (user) { %>
                                    <span class="venue-field-clickable" 
                                          onclick="editVenueField('city', '<%= venue.city %>', <%= venue.id %>)"
                                          title="Click to suggest edit"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <%= venue.city %>
                                        <i class="bi bi-pencil ms-2 small"></i>
                                    </span>
                                <% } else { %>
                                    <%= venue.city %>
                    <% } %>
                            <% } else { %>
                                <% if (user) { %>
                                    <span class="text-muted" 
                                          onclick="addVenueField('city', <%= venue.id %>)"
                                          title="Click to add city"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                        Add city
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">Not provided</span>
                                <% } %>
                            <% } %>
                        </div>
                    </div>

                    <!-- State -->
                        <div class="col-md-6 mb-3">
                        <div>
                            <strong>State:</strong><br>
                            <% if (venue.state) { %>
                                <% if (user) { %>
                                    <span class="venue-field-clickable" 
                                          onclick="editVenueField('state', '<%= venue.state %>', <%= venue.id %>)"
                                          title="Click to suggest edit"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <%= venue.state %>
                                        <i class="bi bi-pencil ms-2 small"></i>
                                    </span>
                                <% } else { %>
                                    <%= venue.state %>
                                <% } %>
                            <% } else { %>
                                <% if (user) { %>
                                    <span class="text-muted" 
                                          onclick="addVenueField('state', <%= venue.id %>)"
                                          title="Click to add state"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                        Add state
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">Not provided</span>
                                <% } %>
                            <% } %>
                        </div>
                    </div>

                    <!-- Zip Code -->
                    <div class="col-md-6 mb-3">
                        <div>
                            <strong>Zip Code:</strong><br>
                            <% if (venue.zipCode) { %>
                                <% if (user) { %>
                                    <span class="venue-field-clickable" 
                                          onclick="editVenueField('zipCode', '<%= venue.zipCode %>', <%= venue.id %>)"
                                          title="Click to suggest edit"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <%= venue.zipCode %>
                                        <i class="bi bi-pencil ms-2 small"></i>
                                    </span>
                                <% } else { %>
                                    <%= venue.zipCode %>
                                <% } %>
                            <% } else { %>
                                <% if (user) { %>
                                    <span class="text-muted" 
                                          onclick="addVenueField('zipCode', <%= venue.id %>)"
                                          title="Click to add zip code"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                        Add zip code
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">Not provided</span>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                    
                    <!-- Phone -->
                    <div class="col-md-6 mb-3">
                        <div>
                            <strong>Phone:</strong><br>
                            <% if (venue.phone) { %>
                                <% if (user) { %>
                                    <span class="venue-field-clickable" 
                                          onclick="editVenueField('phone', '<%= venue.phone %>', <%= venue.id %>)"
                                          title="Click to suggest edit"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-telephone"></i>
                                        <span class="ms-1"><%= venue.phone %></span>
                                        <i class="bi bi-pencil ms-2 small"></i>
                                    </span>
                                <% } else { %>
                            <i class="bi bi-telephone"></i>
                            <a href="tel:<%= venue.phone %>" class="text-decoration-none ms-1">
                                <%= venue.phone %>
                            </a>
                    <% } %>
                            <% } else { %>
                                <% if (user) { %>
                                    <span class="text-muted" 
                                          onclick="addVenueField('phone', <%= venue.id %>)"
                                          title="Click to add phone"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                        Add phone
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">Not provided</span>
                                <% } %>
                            <% } %>
                        </div>
                    </div>

                    <!-- Email -->
                        <div class="col-md-6 mb-3">
                        <div>
                            <strong>Email:</strong><br>
                            <% if (venue.email) { %>
                                <% if (user) { %>
                                    <span class="venue-field-clickable" 
                                          onclick="editVenueField('email', '<%= venue.email %>', <%= venue.id %>)"
                                          title="Click to suggest edit"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-envelope"></i>
                                        <span class="ms-1"><%= venue.email %></span>
                                        <i class="bi bi-pencil ms-2 small"></i>
                                    </span>
                                <% } else { %>
                            <i class="bi bi-envelope"></i>
                            <a href="mailto:<%= venue.email %>" class="text-decoration-none ms-1">
                                <%= venue.email %>
                            </a>
                    <% } %>
                            <% } else { %>
                                <% if (user) { %>
                                    <span class="text-muted" 
                                          onclick="addVenueField('email', <%= venue.id %>)"
                                          title="Click to add email"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                        Add email
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">Not provided</span>
                                <% } %>
                            <% } %>
                        </div>
                    </div>

                    <!-- Website -->
                    <div class="col-12 mb-3">
                        <div>
                            <strong>Website:</strong><br>
                    <% 
                        const mainWebsite = venue.socials?.find(social => social.socialType?.name === 'Website');
                    %>
                    <% if (mainWebsite && mainWebsite.url) { %>
                                <% if (user) { %>
                                    <i class="bi bi-globe"></i>
                                    <a href="<%= mainWebsite.url %>" target="_blank" class="text-decoration-none ms-1">
                                        <%= mainWebsite.url %>
                                    </a>
                                    <i class="bi bi-pencil ms-2 small venue-field-clickable" 
                                          onclick="editVenueField('website', '<%= mainWebsite.url %>', <%= venue.id %>)"
                                          title="Click to suggest edit"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; color: #6c757d;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                    </i>
                                <% } else { %>
                            <i class="bi bi-globe"></i>
                            <a href="<%= mainWebsite.url.startsWith('http') ? mainWebsite.url : 'https://' + mainWebsite.url %>" 
                               target="_blank" class="text-decoration-none ms-1">
                                <%= mainWebsite.url %>
                            </a>
                    <% } %>
                            <% } else { %>
                                <% if (user) { %>
                                    <span class="text-muted" 
                                          onclick="addWebsiteField(<%= venue.id %>)"
                                          title="Click to add website"
                                          style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                          onmouseover="this.style.backgroundColor='#f8f9fa'"
                                          onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                        Add website
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">Not provided</span>
                                <% } %>
                            <% } %>
                        </div>
                    </div>

                    <% 
                        // Filter out website contacts as they're for interactions, not display
                        const displayContacts = venue.contacts?.filter(contact => contact.contactType?.name !== 'WEBSITE') || [];
                    %>
                    <% if (displayContacts.length > 0) { %>
                        <div class="col-12 mb-3">
                            <strong>Additional Contact Information:</strong><br>
                            <% displayContacts.forEach(contact => { %>
                                <div class="mb-2">
                                    <% 
                                        // Fix icon class to avoid duplicate 'bi-'
                                        let iconClass = contact.contactType.iconClass || 'envelope';
                                        if (iconClass.startsWith('bi-')) {
                                            iconClass = iconClass.substring(3); // Remove 'bi-' prefix
                                        }
                                    %>
                                    <i class="bi bi-<%= iconClass %>"></i>
                                    <% if (contact.url) { %>
                                        <a href="<%= contact.url %>" target="_blank" class="text-decoration-none">
                                            <strong><%= contact.contactType.displayName %></strong>
                                        </a>
                                    <% } else { %>
                                        <strong><%= contact.contactType.displayName %>:</strong>
                                        <span class="ms-1"><%= contact.value %></span>
                                    <% } %>
                                    <% if (contact.label) { %>
                                        <small class="text-muted">(<%= contact.label %>)</small>
                                    <% } %>
                                    <% if (user && (user.role === 'admin' || user.role === 'moderator' || venue.createdById === user.id)) { %>
                                        <i class="bi bi-trash ms-2" 
                                           onclick="deleteVenueContact(<%= contact.id %>)"
                                           title="Delete contact"
                                           style="cursor: pointer; font-size: 0.9rem;"
                                           onmouseover="this.style.opacity='0.7'"
                                           onmouseout="this.style.opacity='1'"></i>
                                    <% } %>
                                </div>
                            <% }) %>
                        </div>
                    <% } %>
                    
                    <% if (venue.socials && venue.socials.length > 0) { %>
                        <div class="col-12 mb-3">
                            <strong>Social Media:</strong><br>
                            <% venue.socials.forEach(social => { %>
                                <div class="mb-2">
                                    <i class="bi bi-<%= social.socialType.iconClass || 'globe' %>"></i>
                                    <strong><%= social.socialType.displayName %>:</strong>
                                    <% if (social.url) { %>
                                        <a href="<%= social.url %>" target="_blank" class="text-decoration-none ms-1">
                                            <%= social.handle %>
                                        </a>
                                    <% } else { %>
                                        <span class="ms-1"><%= social.handle %></span>
                                    <% } %>
                                    <% if (user && (user.role === 'admin' || user.role === 'moderator' || venue.createdById === user.id)) { %>
                                        <i class="bi bi-trash ms-2" 
                                           onclick="deleteVenueSocial(<%= social.id %>)"
                                           title="Delete social media"
                                           style="cursor: pointer; font-size: 0.9rem;"
                                           onmouseover="this.style.opacity='0.7'"
                                           onmouseout="this.style.opacity='1'"></i>
                                    <% } %>
                                </div>
                            <% }) %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>



        <!-- Venue Management Panel -->
        <% if (loggedIn && currentUser) { %>
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                <div class="card-header">
                            <h5 class="mb-0">Venue Management</h5>
                </div>
                <div class="card-body">
                            <div class="d-flex gap-2 flex-wrap">
                                <% if (venue.createdById === currentUser.id) { %>
                                    <a href="/venues/<%= venue.id %>/edit" class="btn btn-primary">
                                        <i class="bi bi-pencil"></i> Edit Venue
                                    </a>
                                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                                        <i class="bi bi-trash"></i> Delete Venue
                                    </button>
                                <% } %>
                                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addContactModal">
                                    <i class="bi bi-person-plus"></i> Add Contact
                                </button>
                                <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#addSocialModal">
                                    <i class="bi bi-share"></i> Add Social Media
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    </div>


    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Venue Info</h5>
            </div>
            <div class="card-body">
                <!-- Capacity -->
                    <div class="mb-3">
                        <strong>Capacity:</strong><br>
                    <% if (venue.capacity) { %>
                        <% if (user) { %>
                            <span class="venue-field-clickable" 
                                  onclick="editVenueField('capacity', '<%= venue.capacity %>', <%= venue.id %>)"
                                  title="Click to suggest edit"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                        <i class="bi bi-people"></i> <%= venue.capacity.toLocaleString() %> people
                                <i class="bi bi-pencil ms-2 small"></i>
                            </span>
                        <% } else { %>
                            <i class="bi bi-people"></i> <%= venue.capacity.toLocaleString() %> people
                <% } %>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('capacity', <%= venue.id %>)"
                                  title="Click to add capacity"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add capacity
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                        <% } %>
                    <% } %>
                </div>
                
                <!-- Venue Type -->
                    <div class="mb-3">
                        <strong>Type:</strong><br>
                    <% if (venue.venueType) { %>
                        <span class="badge bg-secondary"><%= venue.venueType.name %></span>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('venueTypeId', <%= venue.id %>)"
                                  title="Click to add venue type"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add venue type
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                <% } %>
                    <% } %>
                </div>
                
                <!-- Music Style -->
                    <div class="mb-3">
                        <strong>Music Style:</strong><br>
                    <% if (venue.musicStyle) { %>
                        <% if (user) { %>
                            <span class="venue-field-clickable" 
                                  onclick="editVenueField('musicStyle', '<%= venue.musicStyle %>', <%= venue.id %>)"
                                  title="Click to suggest edit"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                        <span class="badge bg-warning text-dark"><%= venue.musicStyle %></span>
                                <i class="bi bi-pencil ms-2 small"></i>
                            </span>
                        <% } else { %>
                            <span class="badge bg-warning text-dark"><%= venue.musicStyle %></span>
                <% } %>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('musicStyle', <%= venue.id %>)"
                                  title="Click to add music style"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add music style
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                        <% } %>
                    <% } %>
                </div>
                
                <!-- Stage Location -->
                    <div class="mb-3">
                        <strong>Stage Location:</strong><br>
                    <% if (venue.stageLocation) { %>
                        <% if (user) { %>
                            <span class="venue-field-clickable" 
                                  onclick="editVenueField('stageLocation', '<%= venue.stageLocation %>', <%= venue.id %>)"
                                  title="Click to suggest edit"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                        <span class="badge bg-info text-dark"><%= venue.stageLocation.charAt(0).toUpperCase() + venue.stageLocation.slice(1) %></span>
                                <i class="bi bi-pencil ms-2 small"></i>
                            </span>
                        <% } else { %>
                            <span class="badge bg-info text-dark"><%= venue.stageLocation.charAt(0).toUpperCase() + venue.stageLocation.slice(1) %></span>
                <% } %>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('stageLocation', <%= venue.id %>)"
                                  title="Click to add stage location"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add stage location
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                        <% } %>
                    <% } %>
                </div>
                
                <!-- Booking Status -->
                    <div class="mb-3">
                        <strong>Booking Status:</strong><br>
                    <% if (venue.bookingStatus) { %>
                        <% if (user) { %>
                            <span class="venue-field-clickable" 
                                  onclick="editVenueField('bookingStatus', '<%= venue.bookingStatus %>', <%= venue.id %>)"
                                  title="Click to suggest edit"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                        <%= venue.bookingStatus %>
                                <i class="bi bi-pencil ms-2 small"></i>
                            </span>
                        <% } else { %>
                            <%= venue.bookingStatus %>
                <% } %>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('bookingStatus', <%= venue.id %>)"
                                  title="Click to add booking status"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add booking status
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                        <% } %>
                    <% } %>
                </div>
                
                <!-- Lead Time -->
                    <div class="mb-3">
                        <strong>Lead Time:</strong><br>
                    <% if (venue.leadTime) { %>
                        <% if (user) { %>
                            <span class="venue-field-clickable" 
                                  onclick="editVenueField('leadTime', '<%= venue.leadTime %>', <%= venue.id %>)"
                                  title="Click to suggest edit"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                        <%= venue.leadTime %>
                                <i class="bi bi-pencil ms-2 small"></i>
                            </span>
                        <% } else { %>
                            <%= venue.leadTime %>
                        <% } %>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('leadTime', <%= venue.id %>)"
                                  title="Click to add lead time"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add lead time
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                        <% } %>
                <% } %>
                </div>
            </div>
        </div>

        <!-- Technical Details -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Technical Details</h5>
                </div>
                <div class="card-body">
                <!-- Sound System -->
                        <div class="mb-3">
                            <strong>Sound System:</strong><br>
                    <% if (venue.soundSystem) { %>
                        <% if (user) { %>
                            <span class="venue-field-clickable" 
                                  onclick="editVenueField('soundSystem', '<%= venue.soundSystem %>', <%= venue.id %>)"
                                  title="Click to suggest edit"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                            <%= venue.soundSystem %>
                                <i class="bi bi-pencil ms-2 small"></i>
                            </span>
                        <% } else { %>
                            <%= venue.soundSystem %>
                    <% } %>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('soundSystem', <%= venue.id %>)"
                                  title="Click to add sound system info"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add sound system info
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                        <% } %>
                    <% } %>
                </div>
                
                <!-- Stage Size -->
                        <div class="mb-3">
                            <strong>Stage Size:</strong><br>
                    <% if (venue.stageSize) { %>
                        <% if (user) { %>
                            <span class="venue-field-clickable" 
                                  onclick="editVenueField('stageSize', '<%= venue.stageSize %>', <%= venue.id %>)"
                                  title="Click to suggest edit"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                            <%= venue.stageSize %>
                                <i class="bi bi-pencil ms-2 small"></i>
                            </span>
                        <% } else { %>
                            <%= venue.stageSize %>
                        <% } %>
                    <% } else { %>
                        <% if (user) { %>
                            <span class="text-muted" 
                                  onclick="addVenueField('stageSize', <%= venue.id %>)"
                                  title="Click to add stage size"
                                  style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                                  onmouseover="this.style.backgroundColor='#f8f9fa'"
                                  onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                                Add stage size
                            </span>
                        <% } else { %>
                            <span class="text-muted">Not provided</span>
                        <% } %>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Fees & Payment -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Fees & Payment</h5>
                </div>
                <div class="card-body">
                <% if (venue.fees) { %>
                    <% if (user) { %>
                        <span class="venue-field-clickable" 
                              onclick="editVenueField('fees', '<%= venue.fees %>', <%= venue.id %>)"
                              title="Click to suggest edit"
                              style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                              onmouseover="this.style.backgroundColor='#f8f9fa'"
                              onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                    <%= venue.fees %>
                            <i class="bi bi-pencil ms-2 small"></i>
                        </span>
                    <% } else { %>
                        <%= venue.fees %>
        <% } %>
                <% } else { %>
                    <% if (user) { %>
                        <span class="text-muted" 
                              onclick="addVenueField('fees', <%= venue.id %>)"
                              title="Click to add fees info"
                              style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                              onmouseover="this.style.backgroundColor='#f8f9fa'"
                              onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                            Add fees info
                        </span>
                    <% } else { %>
                        <span class="text-muted">Not provided</span>
                    <% } %>
        <% } %>
    </div>
</div>

        <!-- Notes -->
        <div class="card mb-4">
                <div class="card-header">
                <h5 class="mb-0">Notes</h5>
                </div>
                <div class="card-body">
                <% if (venue.notes) { %>
                    <% if (user) { %>
                        <span class="venue-field-clickable" 
                              onclick="editVenueField('notes', '<%= venue.notes %>', <%= venue.id %>)"
                              title="Click to suggest edit"
                              style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s;"
                              onmouseover="this.style.backgroundColor='#f8f9fa'"
                              onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                            <%= venue.notes.replace(/\n/g, '<br>') %>
                            <i class="bi bi-pencil ms-2 small"></i>
                        </span>
                    <% } else { %>
                        <%= venue.notes.replace(/\n/g, '<br>') %>
                        <% } %>
                <% } else { %>
                    <% if (user) { %>
                        <span class="text-muted" 
                              onclick="addVenueField('notes', <%= venue.id %>)"
                              title="Click to add notes"
                              style="cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.2s; border: 1px dashed #ccc;"
                              onmouseover="this.style.backgroundColor='#f8f9fa'"
                              onmouseout="this.style.backgroundColor='transparent'">
                                        <i class="bi bi-pencil ms-2 small"></i>
                            Add notes
                        </span>
                    <% } else { %>
                        <span class="text-muted">No notes available</span>
                    <% } %>
                <% } %>
            </div>
        </div>
    </div>


    <div class="modal fade" id="addContactModal" tabindex="-1" aria-labelledby="addContactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addContactModalLabel">Add Contact</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addContactForm" method="POST" action="/venues/<%= venue.id %>/contacts">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="contactType" class="form-label">Contact Type *</label>
                            <select class="form-select" id="contactType" name="contactType" required>
                                <option value="">Select Type</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="contactValue" class="form-label">Value *</label>
                            <input type="text" class="form-control" id="contactValue" name="value" 
                                   placeholder="Phone, email, handle, etc." required>
                            <div id="contactValueHelp" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="contactLabel" class="form-label">Label</label>
                            <input type="text" class="form-control" id="contactLabel" name="label" 
                                   placeholder="e.g., Booking, General">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Add Contact</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Social Media Modal -->
    <div class="modal fade" id="addSocialModal" tabindex="-1" aria-labelledby="addSocialModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSocialModalLabel">Add Social Media</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addSocialForm" method="POST" action="/venues/<%= venue.id %>/socials">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="socialType" class="form-label">Platform *</label>
                            <select class="form-select" id="socialType" name="socialType" required>
                                <option value="">Select Platform</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="socialHandle" class="form-label">Handle *</label>
                            <input type="text" class="form-control" id="socialHandle" name="handle" 
                                   placeholder="@username or page name" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-info">Add Social Media</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Contact and Social types data
        const contactTypes = <%- JSON.stringify(typeof contactTypes !== 'undefined' ? contactTypes : []) %>;
        const socialTypes = <%- JSON.stringify(typeof socialTypes !== 'undefined' ? socialTypes : []) %>;

        function confirmDelete() {
            if (confirm('Are you sure you want to delete this venue? This action cannot be undone.')) {
                // Create a form to submit DELETE request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/venues/<%= venue.id %>';
                
                const methodInput = document.createElement('input');
                methodInput.type = 'hidden';
                methodInput.name = '_method';
                methodInput.value = 'DELETE';
                
                form.appendChild(methodInput);
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Populate contact types dropdown
        function populateContactTypes() {
            const contactTypeSelect = document.getElementById('contactType');
            if (contactTypeSelect && contactTypes && contactTypes.length > 0) {
                contactTypes.forEach(contactType => {
                    // Filter out contact types that don't make sense for venue contacts
                    if (contactType.name === 'IN_PERSON' || contactType.name === 'NOTE') {
                        return; // Skip these contact types
                    }
                    
                    const option = document.createElement('option');
                    option.value = contactType.id;
                    option.textContent = contactType.displayName;
                    contactTypeSelect.appendChild(option);
                });
                
                // Add change handler for validation hints
                contactTypeSelect.addEventListener('change', updateContactValueHelp);
            }
        }
        
        // Update help text and validation based on contact type
        function updateContactValueHelp() {
            const contactTypeSelect = document.getElementById('contactType');
            const contactValueInput = document.getElementById('contactValue');
            const helpDiv = document.getElementById('contactValueHelp');
            
            if (!contactTypeSelect.value) {
                helpDiv.textContent = '';
                contactValueInput.placeholder = 'Phone, email, handle, etc.';
                return;
            }
            
            const contactType = contactTypes.find(ct => ct.id == contactTypeSelect.value);
            if (!contactType) return;
            
            // Update placeholder and help text based on contact type
            switch (contactType.name) {
                case 'EMAIL':
                    contactValueInput.placeholder = 'email@example.com';
                    helpDiv.textContent = 'Enter a valid email address';
                    break;
                case 'PHONE_CALL':
                case 'TEXT':
                case 'WHATSAPP':
                    contactValueInput.placeholder = '+1234567890';
                    helpDiv.textContent = 'Enter phone number with country code (e.g., +1234567890)';
                    break;
                case 'FACEBOOK_MESSAGE':
                    contactValueInput.placeholder = 'Woodcellar or https://facebook.com/Woodcellar';
                    helpDiv.textContent = 'Enter Facebook username/page name or full URL';
                    break;
                case 'INSTAGRAM_MESSAGE':
                    contactValueInput.placeholder = 'woodcellardenver or https://instagram.com/woodcellardenver';
                    helpDiv.textContent = 'Enter Instagram username or full URL';
                    break;
                case 'LINKEDIN_MESSAGE':
                    contactValueInput.placeholder = 'company-name or https://linkedin.com/company/company-name';
                    helpDiv.textContent = 'Enter LinkedIn username/company name or full URL';
                    break;
                case 'TWITTER_MESSAGE':
                    contactValueInput.placeholder = 'woodcellar or https://twitter.com/woodcellar';
                    helpDiv.textContent = 'Enter Twitter username or full URL';
                    break;
                case 'TELEGRAM':
                    contactValueInput.placeholder = '@username or username';
                    helpDiv.textContent = 'Enter Telegram username (with or without @)';
                    break;
                case 'DISCORD':
                    contactValueInput.placeholder = 'username#1234 or server invite link';
                    helpDiv.textContent = 'Enter Discord username or server invite link';
                    break;
                case 'WEBSITE_CONTACT_FORM':
                case 'WEBSITE_LIVE_CHAT':
                    contactValueInput.placeholder = 'https://example.com/contact';
                    helpDiv.textContent = 'Enter the full URL to the contact form or chat';
                    break;
                default:
                    contactValueInput.placeholder = 'Enter contact information';
                    helpDiv.textContent = '';
            }
        }

        // Populate social types dropdown
        function populateSocialTypes() {
            const socialTypeSelect = document.getElementById('socialType');
            if (socialTypeSelect && socialTypes && socialTypes.length > 0) {
                socialTypes.forEach(socialType => {
                    const option = document.createElement('option');
                    option.value = socialType.id;
                    option.textContent = socialType.displayName;
                    socialTypeSelect.appendChild(option);
                });
            }
        }

        // Handle contact form submission
        document.getElementById('addContactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const contactTypeId = formData.get('contactType');
            const value = formData.get('value');
            const label = formData.get('label');
            
            // Find the contact type to get URL template
            const contactType = contactTypes.find(ct => ct.id == contactTypeId);
            let url = null;
            if (contactType && contactType.urlTemplate) {
                url = contactType.urlTemplate.replace('{contact}', value);
            }
            
            // Submit the form
            fetch(this.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contactTypeId: parseInt(contactTypeId),
                    value: value,
                    label: label,
                    url: url
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload(); // Refresh the page to show new contact
                } else {
                    alert('Error adding contact: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding contact');
            });
        });

        // Handle social form submission
        document.getElementById('addSocialForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const socialTypeId = formData.get('socialType');
            const handle = formData.get('handle');
            
            // Find the social type to get URL template
            const socialType = socialTypes.find(st => st.id == socialTypeId);
            let url = null;
            if (socialType && socialType.urlTemplate) {
                // Clean the handle to remove any existing URLs
                let cleanHandle = handle.trim();
                
                // Check if the handle is a full URL
                if (cleanHandle.startsWith('http://') || cleanHandle.startsWith('https://')) {
                    try {
                        const urlObj = new URL(cleanHandle);
                        const hostname = urlObj.hostname.toLowerCase();
                        const pathname = urlObj.pathname.replace(/^\/+|\/+$/g, ''); // Remove leading/trailing slashes
                        
                        // Handle different platforms
                        if (hostname.includes('facebook.com') || hostname.includes('fb.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('instagram.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('twitter.com') || hostname.includes('x.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('tiktok.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('youtube.com') || hostname.includes('youtu.be')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('linkedin.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('bandcamp.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('soundcloud.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else if (hostname.includes('snapchat.com')) {
                            cleanHandle = pathname || hostname.replace('www.', '');
                        } else {
                            // For websites and unknown platforms, use the full domain
                            cleanHandle = hostname.replace('www.', '');
                        }
                    } catch (e) {
                        // If URL parsing fails, try to extract domain manually
                        cleanHandle = cleanHandle.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0];
                    }
                }
                
                // Generate URL using template
                if (socialType.name === 'Website') {
                    // For websites, use the full URL if it was provided
                    if (handle.trim().startsWith('http://') || handle.trim().startsWith('https://')) {
                        url = handle.trim();
                    } else {
                        // If no https:// was provided, prepend it
                        url = 'https://' + handle.trim();
                    }
                } else {
                    url = socialType.urlTemplate.replace('{contact}', cleanHandle);
                }
            }
            
            // Submit the form
            fetch(this.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    socialTypeId: parseInt(socialTypeId),
                    handle: handle,
                    url: url
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload(); // Refresh the page to show new social
                } else {
                    alert('Error adding social media: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding social media');
            });
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Contact types:', contactTypes);
            console.log('Social types:', socialTypes);
            populateContactTypes();
            populateSocialTypes();
        });

        // Delete venue contact function
        async function deleteVenueContact(contactId) {
            if (!confirm('Are you sure you want to delete this contact? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`/venues/contacts/${contactId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    // Reload page to show updated data
                    location.reload();
                } else {
                    alert('Error deleting contact');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting contact');
            }
        }

        // Delete venue social media function
        async function deleteVenueSocial(socialId) {
            if (!confirm('Are you sure you want to delete this social media? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`/venues/socials/${socialId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    // Reload page to show updated data
                    location.reload();
                } else {
                    alert('Error deleting social media');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting social media');
            }
        }
    </script>

    <!-- Venue Editing Interface -->
    <% if (user) { %>
        <script>
            // Venue editing functionality
            function editVenueField(fieldName, currentValue, venueId) {
                const isModerator = <%= user && (user.role === 'admin' || user.role === 'moderator') ? 'true' : 'false' %>;
                const isEmpty = !currentValue || currentValue.trim() === '';
                
                // If field is empty, anyone can add data immediately
                if (isEmpty) {
                    addVenueField(fieldName, venueId);
                    return;
                }
                
                // If field has data and user is moderator, allow immediate editing
                if (isModerator) {
                    editVenueFieldImmediate(fieldName, currentValue, venueId);
                    return;
                }
                
                // If field has data and user is not moderator, suggest changes
                suggestVenueChange(fieldName, currentValue, venueId);
            }

            // Immediate editing for moderators
            function editVenueFieldImmediate(fieldName, currentValue, venueId) {
                const modal = new bootstrap.Modal(document.getElementById('addVenueFieldModal'));
                document.getElementById('addFieldName').value = fieldName;
                document.getElementById('addVenueId').value = venueId;
                
                // Update the modal title and field label
                document.getElementById('addModalTitle').textContent = `Edit ${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}`;
                document.getElementById('addFieldLabel').textContent = `${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}:`;
                
                // Configure input type based on field (same logic as addVenueField)
                const fieldContainer = document.getElementById('addFieldContainer');
                
                if (fieldName === 'venueTypeId') {
                    // Venue Type - dropdown
                    fieldContainer.innerHTML = `
                        <select id="addFieldValue" name="fieldValue" class="form-select" required>
                            <option value="">Select Venue Type</option>
                            <option value="1" ${currentValue == '1' ? 'selected' : ''}>Bar</option>
                            <option value="2" ${currentValue == '2' ? 'selected' : ''}>Club</option>
                            <option value="3" ${currentValue == '3' ? 'selected' : ''}>Concert Hall</option>
                            <option value="4" ${currentValue == '4' ? 'selected' : ''}>Restaurant</option>
                            <option value="5" ${currentValue == '5' ? 'selected' : ''}>Theater</option>
                            <option value="6" ${currentValue == '6' ? 'selected' : ''}>Festival</option>
                            <option value="7" ${currentValue == '7' ? 'selected' : ''}>Private Event</option>
                            <option value="8" ${currentValue == '8' ? 'selected' : ''}>Outdoor Venue</option>
                            <option value="9" ${currentValue == '9' ? 'selected' : ''}>Coffee Shop</option>
                            <option value="10" ${currentValue == '10' ? 'selected' : ''}>Brewery</option>
                        </select>
                    `;
                } else if (fieldName === 'capacity') {
                    // Capacity - number input
                    fieldContainer.innerHTML = `
                        <input type="number" id="addFieldValue" name="fieldValue" class="form-control" min="1" placeholder="Enter capacity" value="${currentValue || ''}" required>
                    `;
                } else {
                    // Default - text input
                    fieldContainer.innerHTML = `
                        <input type="text" id="addFieldValue" name="fieldValue" class="form-control" placeholder="Enter ${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}" value="${currentValue || ''}" required>
                    `;
                }
                
                // Show the modal
                modal.show();
            }

            // Suggest changes for regular users
            function suggestVenueChange(fieldName, currentValue, venueId) {
                const modal = new bootstrap.Modal(document.getElementById('editVenueModal'));
                document.getElementById('fieldName').value = fieldName;
                document.getElementById('currentValue').value = currentValue || '';
                document.getElementById('suggestedValue').value = '';
                document.getElementById('reason').value = '';
                document.getElementById('venueId').value = venueId;
                
                // Update the modal title
                document.getElementById('modalTitle').textContent = `Suggest Change to ${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}`;
                
                // Show the modal
                modal.show();
            }

            // Venue field adding functionality
            function addVenueField(fieldName, venueId) {
                const modal = new bootstrap.Modal(document.getElementById('addVenueFieldModal'));
                document.getElementById('addFieldName').value = fieldName;
                document.getElementById('addVenueId').value = venueId;
                document.getElementById('addFieldValue').value = '';
                
                // Update the modal title and field label
                document.getElementById('addModalTitle').textContent = `Add ${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}`;
                document.getElementById('addFieldLabel').textContent = `${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}:`;
                
                // Configure input type based on field
                const fieldContainer = document.getElementById('addFieldContainer');
                let fieldInput;
                
                if (fieldName === 'venueTypeId') {
                    // Venue Type - dropdown
                    fieldContainer.innerHTML = `
                        <select id="addFieldValue" name="fieldValue" class="form-select" required>
                            <option value="">Select Venue Type</option>
                            <option value="1">Bar</option>
                            <option value="2">Club</option>
                            <option value="3">Concert Hall</option>
                            <option value="4">Restaurant</option>
                            <option value="5">Theater</option>
                            <option value="6">Festival</option>
                            <option value="7">Private Event</option>
                            <option value="8">Outdoor Venue</option>
                            <option value="9">Coffee Shop</option>
                            <option value="10">Brewery</option>
                        </select>
                    `;
                } else if (fieldName === 'state') {
                    // State - dropdown
                    fieldContainer.innerHTML = `
                        <select id="addFieldValue" name="fieldValue" class="form-select" required>
                            <option value="">Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    `;
                } else if (fieldName === 'musicStyle') {
                    // Music Style - dropdown
                    fieldContainer.innerHTML = `
                        <select id="addFieldValue" name="fieldValue" class="form-select" required>
                            <option value="">Select Music Style</option>
                            <option value="Rock">Rock</option>
                            <option value="Pop">Pop</option>
                            <option value="Jazz">Jazz</option>
                            <option value="Blues">Blues</option>
                            <option value="Country">Country</option>
                            <option value="Folk">Folk</option>
                            <option value="Electronic">Electronic</option>
                            <option value="Hip-Hop">Hip-Hop</option>
                            <option value="R&B">R&B</option>
                            <option value="Classical">Classical</option>
                            <option value="Reggae">Reggae</option>
                            <option value="Alternative">Alternative</option>
                            <option value="Indie">Indie</option>
                            <option value="Punk">Punk</option>
                            <option value="Metal">Metal</option>
                            <option value="Acoustic">Acoustic</option>
                            <option value="Cover Band">Cover Band</option>
                            <option value="Original Music">Original Music</option>
                            <option value="Mixed">Mixed</option>
                            <option value="Other">Other</option>
                        </select>
                    `;
                } else if (fieldName === 'stageLocation') {
                    // Stage Location - dropdown
                    fieldContainer.innerHTML = `
                        <select id="addFieldValue" name="fieldValue" class="form-select" required>
                            <option value="">Select Stage Location</option>
                            <option value="inside">Inside</option>
                            <option value="outside">Outside</option>
                            <option value="both">Both</option>
                        </select>
                    `;
                } else if (fieldName === 'bookingStatus') {
                    // Booking Status - dropdown
                    fieldContainer.innerHTML = `
                        <select id="addFieldValue" name="fieldValue" class="form-select" required>
                            <option value="">Select Booking Status</option>
                            <option value="Accepting Bookings">Accepting Bookings</option>
                            <option value="Limited Availability">Limited Availability</option>
                            <option value="Not Accepting Bookings">Not Accepting Bookings</option>
                            <option value="Contact for Availability">Contact for Availability</option>
                            <option value="Seasonal">Seasonal</option>
                        </select>
                    `;
                } else if (fieldName === 'capacity') {
                    // Capacity - number input
                    fieldContainer.innerHTML = `
                        <input type="number" id="addFieldValue" name="fieldValue" class="form-control" min="1" placeholder="Enter capacity" required>
                    `;
                } else {
                    // Default - text input
                    fieldContainer.innerHTML = `
                        <input type="text" id="addFieldValue" name="fieldValue" class="form-control" placeholder="Enter ${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}" required>
                    `;
                }
                
                // Show the modal
                modal.show();
            }

            async function submitVenueChange() {
                const form = document.getElementById('venueChangeForm');
                const formData = new FormData(form);
                
                // Convert FormData to JSON
                const data = {
                    venueId: formData.get('venueId'),
                    fieldName: formData.get('fieldName'),
                    currentValue: formData.get('currentValue'),
                    suggestedValue: formData.get('suggestedValue'),
                    reason: formData.get('reason')
                };
                
                console.log('Submitting venue change:', data);
                
                try {
                    const response = await fetch('/venues/venue-changes', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                     if (response.ok) {
                         const result = await response.json();
                         if (result.success) {
                             // Show success message
                             alert('Change suggestion submitted successfully. We\'ll review it shortly.');
                             // Hide the modal
                             const modal = bootstrap.Modal.getInstance(document.getElementById('editVenueModal'));
                             modal.hide();
                         } else {
                             alert('Error: ' + (result.error || 'Failed to submit change'));
                         }
                     } else {
                         alert('Error submitting change');
                     }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error submitting change');
                }
            }

             async function submitAddVenueField() {
                 const form = document.getElementById('addVenueFieldForm');
                 const formData = new FormData(form);
                 
                 // Convert FormData to JSON
                 const data = {
                     venueId: formData.get('venueId'),
                     fieldName: formData.get('fieldName'),
                     fieldValue: formData.get('fieldValue')
                 };
                 
                 console.log('Adding venue field:', data);
                 
                 try {
                     const response = await fetch('/venues/add-field', {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json'
                         },
                         body: JSON.stringify(data)
                     });
                     
                 if (response.ok) {
                     const result = await response.json();
                     if (result.success) {
                         // Reload page to show new data
                         location.reload();
                     } else {
                         alert('Error: ' + (result.error || 'Failed to add field'));
                     }
                 } else {
                     alert('Error adding field');
                 }
                 } catch (error) {
                     console.error('Error:', error);
                     alert('Error adding field');
                 }
             }

             // Add website field functionality - opens social media modal with website pre-selected
             function addWebsiteField(venueId) {
                 // Ensure social types are populated first
                 populateSocialTypes();
                 
                 // Small delay to ensure dropdown is populated
                 setTimeout(() => {
                     // Open the social media modal
                     const modal = new bootstrap.Modal(document.getElementById('addSocialModal'));
                     
                     // Find the Website social type and select it
                     const socialTypeSelect = document.getElementById('socialType');
                     if (!socialTypeSelect) {
                         console.error('Social type select element not found');
                         modal.show();
                         return;
                     }
                     
                     const websiteOption = Array.from(socialTypeSelect.options).find(option => 
                         option.textContent.toLowerCase().includes('website')
                     );
                     
                     if (websiteOption) {
                         socialTypeSelect.value = websiteOption.value;
                         // Trigger change event to update placeholder
                         socialTypeSelect.dispatchEvent(new Event('change'));
                     } else {
                         console.log('Website option not found in social types');
                     }
                     
                     // Clear the handle field and set placeholder
                     const handleInput = document.getElementById('socialHandle');
                     if (handleInput) {
                         handleInput.value = '';
                         handleInput.placeholder = 'https://example.com';
                     }
                     
                     // Clear URL field
                     const urlInput = document.getElementById('socialUrl');
                     if (urlInput) {
                         urlInput.value = '';
                         urlInput.placeholder = 'https://example.com';
                     }
                     
                     // Show the modal
                     modal.show();
                 }, 100);
             }
        </script>

        <!-- Edit Venue Modal -->
        <div class="modal fade" id="editVenueModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">Edit Venue Field</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form id="venueChangeForm">
                        <div class="modal-body">
                            <input type="hidden" id="venueId" name="venueId">
                            <input type="hidden" id="fieldName" name="fieldName">
                            
                            <div class="mb-3">
                                <label class="form-label">Current Value:</label>
                                <input type="text" id="currentValue" name="currentValue" class="form-control" readonly>
                            </div>
                            
                            <div class="mb-3">
                                <label for="suggestedValue" class="form-label">Suggested Value:</label>
                                <input type="text" id="suggestedValue" name="suggestedValue" class="form-control" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="reason" class="form-label">Reason for Change (optional):</label>
                                <textarea id="reason" name="reason" class="form-control" rows="3" 
                                        placeholder="Why should this field be changed?"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="submitVenueChange()">Submit Suggestion</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Venue Field Modal -->
        <div class="modal fade" id="addVenueFieldModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addModalTitle">Add Venue Field</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form id="addVenueFieldForm">
                        <div class="modal-body">
                            <input type="hidden" id="addVenueId" name="venueId">
                            <input type="hidden" id="addFieldName" name="fieldName">
                            
                            <div class="mb-3">
                                <label for="addFieldValue" class="form-label" id="addFieldLabel">Value:</label>
                                <div id="addFieldContainer">
                                    <input type="text" id="addFieldValue" name="fieldValue" class="form-control" required>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-success" onclick="submitAddVenueField()">Add Field</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    <% } %>
</div>