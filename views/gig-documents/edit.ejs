<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="bi bi-pencil"></i> Edit Gig Document</h1>
        <a
          href="/songs/<%= gigDocument.Song.id %>/docs/<%= gigDocument.id %>"
          class="btn btn-outline-secondary"
        >
          <i class="bi bi-arrow-left"></i> Back to Document
        </a>
      </div>

      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <form
                action="/songs/<%= gigDocument.Song.id %>/docs/<%= gigDocument.id %>?_method=PUT"
                method="POST"
              >
                <div class="mb-3">
                  <label class="form-label">Document Type</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= gigDocument.getTypeDisplayName() %> (v<%= gigDocument.version %>)"
                    readonly
                  />
                  <div class="form-text">
                    Document type and version cannot be changed
                  </div>
                </div>

                <div class="mb-3">
                  <label for="content" class="form-label">Content</label>
                  <textarea id="editor" name="content" style="height: 400px">
<%- gigDocument.content || '' %></textarea
                  >
                  <div class="form-text">
                    Use the rich text editor above to edit your content
                  </div>
                </div>

                <div class="d-flex justify-content-between">
                  <a
                    href="/songs/<%= gigDocument.Song.id %>/docs/<%= gigDocument.id %>"
                    class="btn btn-outline-secondary"
                    >Cancel</a
                  >
                  <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Save Changes
                  </button>
                </div>
              </form>
            </div>

            <div class="col-md-4">
              <div class="card bg-light">
                <div class="card-body">
                  <h6 class="card-title">
                    <i class="bi bi-info-circle"></i> Document Info
                  </h6>

                  <p class="small">
                    <strong>Song:</strong>
                    <%= gigDocument.Song.title %><br />
                    <strong>Type:</strong>
                    <%= gigDocument.getTypeDisplayName() %><br />
                    <strong>Version:</strong>
                    <%= gigDocument.version %><br />
                    <strong>Created:</strong>
                    <%= gigDocument.createdAt.toLocaleDateString() %><br />
                    <strong>Updated:</strong>
                    <%= gigDocument.updatedAt.toLocaleDateString() %>
                  </p>

                  <h6 class="card-title">
                    <i class="bi bi-lightbulb"></i> Tips
                  </h6>
                  <ul class="small">
                    <li>Use the table button to create structured layouts</li>
                    <li>Apply monospace font to preserve spacing in tables</li>
                    <li>Use headers to organize your content</li>
                    <li>Save frequently to avoid losing changes</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TinyMCE -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.3/tinymce.min.js"></script>
<script src="/js/gig-document-editor.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {

    // Get existing content from textarea value
    var textarea = document.getElementById("editor");
    var existingContent = textarea.value || null;

    // Initialize the shared editor with existing content
    const editor = new GigDocumentEditor("editor", {
      existingContent: existingContent,
      formSelector: "#editor",
    });

    // Update textarea before form submission
    document
      .querySelector('form[action*="/docs"]')
      .addEventListener("submit", function () {
      
        var content = tinymce.get("editor").getContent();
       
        var textarea = document.getElementById("editor");
        if (textarea) {
          textarea.value = content;
        }

      });
  });
</script>
