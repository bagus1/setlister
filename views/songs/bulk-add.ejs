<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-body">

                    <!-- Display Results -->
                    <% if (typeof results !=='undefined' ) { %>
                        <div class="mb-4">
                            <% if (results.added.length> 0) { %>
                                <div class="alert alert-success">
                                    <h5><i class="bi bi-check-circle"></i> Successfully Added <%= results.added.length
                                            %> Songs</h5>
                                    <% if (results.detectedFormat) { %>
                                        <p class="mb-2"><small class="text-muted">Detected format: <strong>
                                                    <%= results.detectedFormat %>
                                                </strong></small></p>
                                        <% } %>
                                            <ul class="mb-0">
                                                <% results.added.forEach(title=> { %>
                                                    <li>
                                                        <%= title %>
                                                    </li>
                                                    <% }) %>
                                            </ul>
                                </div>
                                <% } %>

                                    <% if (results.skipped && results.skipped.length> 0) { %>
                                        <div class="alert alert-warning">
                                            <h6><i class="bi bi-exclamation-triangle"></i> Duplicates Skipped (<%=
                                                    results.skipped.length %>)</h6>
                                            <ul class="mb-0">
                                                <% results.skipped.forEach(msg=> { %>
                                                    <li>
                                                        <%= msg %>
                                                    </li>
                                                    <% }) %>
                                            </ul>
                                        </div>
                                        <% } %>

                                            <% if (results.errors && results.errors.length> 0) { %>
                                                <div class="alert alert-danger">
                                                    <h6><i class="bi bi-x-circle"></i> Errors (<%= results.errors.length
                                                            %>)</h6>
                                                    <ul class="mb-0">
                                                        <% results.errors.forEach(msg=> { %>
                                                            <li>
                                                                <%= msg %>
                                                            </li>
                                                            <% }) %>
                                                    </ul>
                                                </div>
                                                <% } %>

                                                    <% if (results.added.length> 0) { %>
                                                        <div class="mt-3">
                                                            <a href="/songs" class="btn btn-primary">
                                                                <i class="bi bi-arrow-left"></i> View All Songs
                                                            </a>
                                                            <a href="/bulk-add-songs" class="btn btn-secondary">Add More
                                                                Songs</a>
                                                        </div>
                                                        <% } %>
                        </div>
                        <% } %>

                            <!-- Display Errors -->
                            <% if (typeof errors !=='undefined' && errors.length> 0) { %>
                                <div class="alert alert-danger mb-4">
                                    <h6>Please fix the following errors:</h6>
                                    <ul class="mb-0">
                                        <% errors.forEach(error=> { %>
                                            <li>
                                                <%= error.msg %>
                                            </li>
                                            <% }) %>
                                    </ul>
                                </div>
                                <% } %>

                                    <!-- Bulk Add Form -->
                                    <% if (typeof results==='undefined' || !results || results.added.length===0) { %>
                                        <form method="POST" action="/bulk-add-songs">
                                            <!-- Smart Format Detection Notice -->
                                            <div class="alert alert-info mb-4">
                                                <h6><i class="bi bi-lightbulb"></i> How to Add Songs</h6>
                                                <p class="mb-0">You can paste songs here one song per line and they will
                                                    be imported. You can add additional information about the song by
                                                    adding it in the following order and separating them by commas:
                                                    title, artist, vocalist, key, time, bpm.</p>
                                                <hr>
                                                <strong>Examples:</strong><br>
                                                <strong>Simple:</strong> Sweet Child O' Mine<br>
                                                <strong>With Artist:</strong> Hotel California, Eagles<br>
                                                <strong>Full Details:</strong> Better Days, Bruce Springsteen, Bagus,
                                                Eb, 3:33, 125
                                            </div>

                                            <!-- Song Data Textarea -->
                                            <div class="mb-4">
                                                <label for="data" class="form-label fw-bold">Song Data:</label>
                                                <textarea class="form-control" id="data" name="data" rows="15"
                                                    placeholder="Paste your song data here..."
                                                    required><%= typeof data !== 'undefined' ? data : '' %></textarea>
                                            </div>

                                            <!-- Submit Button -->
                                            <div class="d-flex gap-2">
                                                <button type="submit" class="btn btn-success">
                                                    <i class="bi bi-upload"></i> Add Songs
                                                </button>
                                                <a href="/songs" class="btn btn-secondary">
                                                    <i class="bi bi-arrow-left"></i> Back to Songs
                                                </a>
                                            </div>
                                        </form>
                                        <% } %>
                </div>
            </div>

            <!-- Additional Help -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="bi bi-info-circle"></i> Smart Parsing Tips</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>üéØ Auto-Detection</h6>
                            <p class="small">If your data contains commas, it's treated as CSV. Otherwise, it's
                                parsed as line-separated.</p>
                        </div>
                        <div class="col-md-4">
                            <h6>üéµ Duplicates</h6>
                            <p class="small">Songs with the same title will be skipped automatically.</p>
                        </div>
                        <div class="col-md-4">
                            <h6>üéπ Valid Keys</h6>
                            <p class="small">C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, B<br>
                                Cm, C#m, Dbm, Dm, D#m, Ebm, Em, Fm, F#m, Gbm, Gm, G#m, Abm, Am, A#m, Bbm, Bm</p>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <h6>‚è±Ô∏è Time Format</h6>
                            <p class="small">Use MM:SS (like 3:45) or total seconds (like 225).</p>
                        </div>
                        <div class="col-md-4">
                            <h6>üìù Mixed Formats</h6>
                            <p class="small">You can mix formats in the same import - the system handles each line
                                appropriately.</p>
                        </div>
                        <div class="col-md-4">
                            <h6>üîç Line Numbers</h6>
                            <p class="small">Error messages include line numbers to help you identify and fix
                                issues.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dataTextarea = document.getElementById('data');

        // Update placeholder with dynamic examples
        dataTextarea.placeholder = `Paste your song data here...`;
    });
</script>