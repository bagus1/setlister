<div class="row">
    <div class="col-12">
        <% if (loggedIn) { %>
            <p class="text-muted">Manage your bands, songs, and setlists</p>
            <% } else { %>
                <h1>Welcome to The Band Plan</h1>
                <p class="text-muted">Collaborative setlist management for bands</p>

                <div class="alert alert-info mb-4">
                    <i class="bi bi-info-circle"></i>
                    Welcome to The Band Plan where you'll be able to manage your bands' songs and setlists, and even contact venues to get booked! Check out our large library of songs and venues to get you gigging. To get started, <a href="/auth/register" class="alert-link">create an account</a>. We'll have some more information on getting started after you do!
                </div>
                <% } %>
    </div>
</div>

<div class="row">
    <% if (loggedIn) { %>
        <!-- Bands Card -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h5 class="mb-0">
                            <i class="bi bi-people"></i> My Bands
                        </h5>
                        <small class="text-muted">Bands you're a member of</small>
                    </div>
                    <a href="/bands/new" class="btn btn-primary btn-sm flex-shrink-0">
                        <i class="bi bi-plus"></i> Create Band
                    </a>
                </div>
                <div class="card-body">
                    <p class="text-muted small">It's not like it has to be an active band! Add any band you can imagine!</p>
                    <% if (userBands && userBands.length> 0) { %>
                        <% userBands.forEach(band=> { %>
                            <div class="mb-2">
                                <a href="/bands/<%= band.id %>" class="text-decoration-none">
                                    <strong><%= band.name %></strong>
                                </a>
                                <% if (band.description) { %>
                                    <br><small class="text-muted"><%= band.description %></small>
                                <% } %>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="text-muted">No bands yet. Create your first band to get started!</p>
                        <p class="text-muted small">If you received an invitation, make sure you registered with the email address that was invited</p>
                    <% } %>
                    <% if (userBands && userBands.length >= 15) { %>
                        <div class="mt-3">
                            <a href="/bands" class="btn btn-outline-primary btn-sm">View My Bands</a>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Latest Band Songs Card -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-music-note"></i> Latest Band Songs
                    </h5>
                    <small class="text-muted">Songs recently added to your bands' repertoires</small>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Heads up, you may have to learn these quick!</p>
                    <% if (latestBandSongs && latestBandSongs.length> 0) { %>
                        <% latestBandSongs.forEach(bandSong=> { %>
                            <div class="mb-2 d-flex justify-content-between align-items-start">
                                <div>
                                                                    <a href="/songs/<%= bandSong.song.id %>" class="text-decoration-none">
                                    <strong><%= bandSong.song.title %></strong>
                                </a>
                                <% if (bandSong.song.artists && bandSong.song.artists.length> 0) { %>
                                    <br><small class="text-muted">by <%= bandSong.song.artists[0].artist.name %></small>
                                <% } %>
                            </div>
                            <a href="/bands/<%= bandSong.band.id %>" class="btn btn-outline-secondary btn-sm">
                                <%= bandSong.band.name %>
                                </a>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="text-muted">No band songs yet. Add songs to your bands to get started!</p>
                    <% } %>
                    <div class="mt-3">
                        <a href="/songs" class="btn btn-outline-primary btn-sm">View All Songs</a>
                    </div>
                </div>
            </div>
        </div>



        <!-- Artists Card -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-person-circle"></i> Recent Artists
                    </h5>
                    <small class="text-muted">New Artists from songs recently added to our community library</small>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Your next great song might just have been added</p>
                    <% if (artists && artists.length> 0) { %>
                        <% artists.forEach(artist=> { %>
                            <% 
                            // Filter out artists that only have private songs
                            const hasVisibleSongs = artist.songs && artist.songs.some(songArtist => !songArtist.song.private);
                            %>
                            <% if (hasVisibleSongs) { %>
                                <div class="mb-2">
                                    <a href="/artists/<%= artist.id %>" class="text-decoration-none">
                                        <strong><%= artist.name %></strong>
                                    </a>
                                </div>
                            <% } %>
                        <% }) %>
                    <% } else { %>
                        <p class="text-muted">No artists yet. Artists are created when you add songs!</p>
                    <% } %>
                    <div class="mt-3">
                        <a href="/artists" class="btn btn-outline-primary btn-sm">View All Artists</a>
                    </div>
                </div>
            </div>
        </div>

        <% } else { %>
            <!-- Logged out view -->

            <!-- Bands List (linked to public pages) -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-people"></i> Amazing Bands
                        </h5>
                        <small class="text-muted">Check out these bands!</small>
                    </div>
                    <div class="card-body">
                        <% if (bands && bands.length> 0) { %>
                            <% bands.forEach(band=> { %>
                                <div class="py-1">
                                    <% if (band.slug && band.isPublic) { %>
                                        <a href="/<%= band.slug %>" class="text-decoration-none">
                                            <strong><%= band.name %></strong>
                                        </a>
                                    <% } else { %>
                                        <%= band.name %>
                                    <% } %>
                                    <% if (band.description) { %>
                                        <br><small class="text-muted">
                                            <%= band.description %>
                                        </small>
                                    <% } %>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p class="text-muted">No bands yet.</p>
                                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Songs List (linked) -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-music-note"></i> Recent Songs
                        </h5>
                        <small class="text-muted">Latest songs added by users</small>
                    </div>
                    <div class="card-body">
                        <% if (songs && songs.length> 0) { %>
                            <% songs.forEach(song=> { %>
                                <div class="py-1">
                                    <a href="/songs/<%= song.id %>" class="text-decoration-none">
                                        <%= song.title %>
                                    </a>
                                    <% if (song.artists && song.artists.length> 0) { %>
                                        <small class="text-muted">by <%= song.artists[0].artist.name %></small>
                                        <% } %>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p class="text-muted">No songs yet.</p>
                                        <% } %>
                                            <div class="mt-3">
                                                <a href="/songs" class="btn btn-outline-primary btn-sm">View All
                                                    Songs</a>
                                            </div>
                    </div>
                </div>
            </div>

            <!-- Artists List (linked) -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-person-circle"></i> Recent Artists
                        </h5>
                        <small class="text-muted">Artists with recent new songs</small>
                    </div>
                    <div class="card-body">
                        <% if (artists && artists.length> 0) { %>
                            <% artists.forEach(artist=> { %>
                                <div class="py-1">
                                    <a href="/artists/<%= artist.id %>" class="text-decoration-none">
                                        <%= artist.name %>
                                    </a>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p class="text-muted">No artists yet.</p>
                                        <% } %>
                                            <div class="mt-3">
                                                <a href="/artists" class="btn btn-outline-primary btn-sm">View All
                                                    Artists</a>
                                            </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card special-border-card">
                        <div class="card-body text-center">
                            <h5 class="card-title">New Feature!</h5>
                            <p class="card-text">The Band Plan now has a cool new feature you should check out!</p>
                            <a href="/auth/register" class="btn btn-primary">Get Started</a>
                        </div>
                    </div>
                </div>
            </div>
            <% } %>
</div>