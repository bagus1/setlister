<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Create New Gig Document</h1>
        <a href="/songs/<%= song.id %>/docs" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Song Documents
        </a>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">New Gig Document for "<%= song.title %>"</h5>
                </div>
                <div class="card-body">
                    <form action="/songs/<%= song.id %>/docs" method="POST">
                        <div class="mb-3">
                            <label for="type" class="form-label">Document Type *</label>
                            <select class="form-select" id="type" name="type" required>
                                <option value="">Select a type...</option>
                                <option value="chords">üé∏ Chords</option>
                                <option value="bass-tab">üé∏ Bass Tab</option>
                                <option value="guitar-tab">üé∏ Guitar Tab</option>
                                <option value="lyrics">üé§ Lyrics</option>
                            </select>
                            <div class="form-text">Choose the type of content this document will contain.</div>
                        </div>

                        <div class="mb-3">
                            <label for="content" class="form-label">Content</label>
                            <div id="editor" style="height: 400px;"></div>
                            <input type="hidden" id="content" name="content">
                            <div class="form-text">Use the editor above to create your gig document content.</div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Create Gig Document
                            </button>
                            <a href="/songs/<%= song.id %>/docs" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Song Information</h6>
                </div>
                <div class="card-body">
                    <p><strong>Title:</strong>
                        <%= song.title %>
                    </p>
                    <p><strong>Artist:</strong>
                        <%= song.Artists.map(a=> a.name).join(', ') %>
                    </p>
                    <% if (song.Vocalist) { %>
                        <p><strong>Vocalist:</strong>
                            <%= song.Vocalist.name %>
                        </p>
                        <% } %>
                            <% if (song.key) { %>
                                <p><strong>Key:</strong>
                                    <%= song.key %>
                                </p>
                                <% } %>
                                    <% if (song.duration) { %>
                                        <p><strong>Duration:</strong>
                                            <%= song.duration %>
                                        </p>
                                        <% } %>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">Tips</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">üé∏ <strong>Chords:</strong> Include chord progressions, structure markers</li>
                        <li class="mb-2">üé∏ <strong>Tabs:</strong> Add finger positions and techniques</li>
                        <li class="mb-2">üé§ <strong>Lyrics:</strong> Use proper indentation for sections</li>
                        <li class="mb-0">üìù <strong>Format:</strong> Design for single-page printing</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quill.js CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<!-- Quill.js JavaScript -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<script>
    // Initialize Quill editor
    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, false] }],
                ['bold', 'italic', 'underline'],
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                [{ 'indent': '-1' }, { 'indent': '+1' }],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'font': [] }],
                [{ 'size': ['small', false, 'large', 'huge'] }],
                ['clean']
            ]
        },
        placeholder: 'Start typing your gig document content here...'
    });

    // Update hidden input before form submission
    document.querySelector('form[action*="/docs"]').addEventListener('submit', function () {
        console.log('=== FORM SUBMISSION DEBUG ===');
        console.log('Form submit event triggered');

        var quillContent = quill.root.innerHTML;
        console.log('Quill content:', quillContent);
        console.log('Quill content length:', quillContent.length);

        var hiddenInput = document.getElementById('content');
        console.log('Hidden input found:', !!hiddenInput);
        console.log('Hidden input current value:', hiddenInput.value);

        hiddenInput.value = quillContent;
        console.log('Hidden input value after update:', hiddenInput.value);

        console.log('Form submission proceeding...');
    });
</script>