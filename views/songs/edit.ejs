<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="bi bi-pencil"></i> Edit Song: <%= song.title %>
                </h4>
            </div>
            <div class="card-body">
                <% if (typeof errors !=='undefined' && errors.length> 0) { %>
                    <div class="alert alert-danger">
                        <ul class="mb-0">
                            <% errors.forEach(error=> { %>
                                <li>
                                    <%= error.msg %>
                                </li>
                                <% }) %>
                        </ul>
                    </div>
                    <% } %>

                        <form action="/songs/<%= song.id %>/update" method="POST">
                            <div class="mb-3">
                                <label for="title" class="form-label">Song Title</label>
                                <input type="text" class="form-control bg-light" id="title" name="title"
                                    value="<%= song.title %>" readonly>
                                <div class="form-text text-muted">Song title cannot be edited</div>
                            </div>

                            <div class="mb-3">
                                <label for="artist" class="form-label">Artist</label>
                                <input type="text" class="form-control bg-light" id="artist" name="artist"
                                    value="<%= song.Artists && song.Artists.length > 0 ? song.Artists[0].name : '' %>"
                                    readonly>
                                <div class="form-text text-muted">Artist cannot be edited</div>
                            </div>

                            <div class="mb-3">
                                <label for="vocalist" class="form-label">Vocalist</label>
                                <input type="text" class="form-control" id="vocalist" name="vocalist"
                                    value="<%= song.Vocalist ? song.Vocalist.name : '' %>" list="vocalistsList"
                                    placeholder="Who sings this song?">
                                <datalist id="vocalistsList">
                                    <% vocalists.forEach(vocalist=> { %>
                                        <option value="<%= vocalist.name %>">
                                            <% }) %>
                                </datalist>
                                <div class="form-text">Type to search existing vocalists or enter a new one</div>
                            </div>

                            <div class="mb-3">
                                <label for="key" class="form-label">Key</label>
                                <select class="form-control" id="key" name="key">
                                    <option value="">Select key...</option>
                                    <% ['C', 'Cm' , 'C#' , 'C#m' , 'Db' , 'Dbm' , 'D' , 'Dm' , 'D#' , 'D#m' , 'Eb'
                                        , 'Ebm' , 'E' , 'Em' , 'F' , 'Fm' , 'F#' , 'F#m' , 'Gb' , 'Gbm' , 'G' , 'Gm'
                                        , 'G#' , 'G#m' , 'Ab' , 'Abm' , 'A' , 'Am' , 'A#' , 'A#m' , 'Bb' , 'Bbm' , 'B'
                                        , 'Bm' ].forEach(k=> { %>
                                        <option value="<%= k %>" <% if (song.key===k) { %> selected<% } %>><%= k %>
                                        </option>
                                        <% }) %>
                                </select>
                                <div class="form-text">Optional: Select the musical key of the song.</div>
                            </div>

                            <div class="mb-3">
                                <label for="time" class="form-label">Duration (Optional)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="timeMinutes" name="minutes" placeholder="Min" min="0"
                                        max="59">
                                    <span class="input-group-text">:</span>
                                    <input type="number" class="form-control" id="timeSeconds" name="seconds" placeholder="Sec" min="0"
                                        max="59">
                                    <input type="hidden" id="time" name="time">
                                </div>
                                <div class="form-text">Used to calculate setlist timing</div>
                            </div>

                            <div class="mb-3">
                                <label for="bpm" class="form-label">BPM (Beats Per Minute)</label>
                                <input type="number" class="form-control" id="bpm" name="bpm"
                                    value="<%= song.bpm || '' %>" placeholder="Beats per minute" min="40" max="300">
                                <div class="form-text">Optional: Tempo in beats per minute. Typical range: 60-180 BPM.
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <a href="/songs/<%= song.id %>" class="btn btn-outline-secondary">
                                    <i class="bi bi-arrow-left"></i> Cancel
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save"></i> Update Song
                                </button>
                            </div>
                        </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Handle time input conversion
    document.addEventListener('DOMContentLoaded', () => {
        const minutesInput = document.getElementById('timeMinutes');
        const secondsInput = document.getElementById('timeSeconds');
        const timeInput = document.getElementById('time');

  // Initialize with existing song time
  <% if (song.time) { %>
    const totalTime = <%= song.time %>;
            minutesInput.value = Math.floor(totalTime / 60);
            secondsInput.value = totalTime % 60;
            timeInput.value = totalTime;
  <% } %>

            function updateTimeValue() {
                const minutes = parseInt(minutesInput.value) || 0;
                const seconds = parseInt(secondsInput.value) || 0;
                const totalSeconds = (minutes * 60) + seconds;
                timeInput.value = totalSeconds > 0 ? totalSeconds : '';
            }

        minutesInput.addEventListener('input', updateTimeValue);
        secondsInput.addEventListener('input', updateTimeValue);

  // Handle form data override if it exists
  <% if (typeof formData !== 'undefined' && formData.time) { %>
    const formTime = <%= formData.time %>;
            minutesInput.value = Math.floor(formTime / 60);
            secondsInput.value = formTime % 60;
            timeInput.value = formTime;
  <% } %>
});
</script>