<div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <%= getTypeDisplayName(gigDocument.type) %> - v<%= gigDocument.version %>
            </h1>
            <div class="btn-group">
                <button onclick="window.open('?print=true', '_blank')" class="btn btn-primary">
                    <i class="bi bi-printer"></i> Print
                </button>
                <a href="/songs/<%= gigDocument.song.id %>" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Song
                </a>
            </div>
        </div>


        <div class="row">
            <div class="col-md-8">
                    <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h5 class="mb-0">
                                <%= gigDocument.song.title %>
                                <% if (gigDocument.song.artists && gigDocument.song.artists.length > 0) { %>
                                    - <%= gigDocument.song.artists.map(a => a.artist.name).join(', ') %>
                                <% } %>
                            </h5>
                            <small class="text-muted">
                                <% if (gigDocument.song.vocalist) { %>
                                    Vocalist: <%= gigDocument.song.vocalist.name %> •
                                <% } %>
                                <% if (gigDocument.song.key) { %>
                                    Key: <%= gigDocument.song.key %> •
                                <% } %>
                                <% if (gigDocument.song.duration) { %>
                                    Duration: <%= gigDocument.song.duration %>
                                <% } %>
                            </small>
                        </div>
                        <div class="col-auto">
                            <span class="badge bg-primary">
                                <%= getTypeDisplayName(gigDocument.type) %>
                            </span>
                            <span class="badge bg-secondary">v<%= gigDocument.version %></span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <% if (gigDocument.content && gigDocument.content.trim()) { %>
                        <div class="gig-document-content">
                            <%- gigDocument.content %>
                        </div>
                    <% } else { %>
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            This gig document doesn't have any content yet.
                            <a href="/songs/<%= gigDocument.song.id %>/docs/<%= gigDocument.id %>/edit">Add content</a> to make it useful for gigs.
                        </div>
                    <% } %>
                </div>
            </div>

        </div>

        <div class="col-md-4">
            <!-- Media Player Section - Above Document Info -->
            <% if (gigDocument.song.links && gigDocument.song.links.length > 0) { %>
                <div class="card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-music-note-beamed"></i> Listen While Reading
                        </h6>
                    </div>
                    <div class="card-body">
                        <!-- Link Selection Menu -->
                        <div class="mb-3">
                            <label class="form-label small">Choose Audio/Video:</label>
                            <select class="form-select form-select-sm" id="mediaSelect" onchange="loadMediaPlayer()">
                                <option value="">Select a link...</option>
                                <% 
                                    let firstAudioLink = null;
                                    gigDocument.song.links.forEach((link, index) => { 
                                        if (['audio', 'spotify', 'youtube'].includes(link.type) && !firstAudioLink) {
                                            firstAudioLink = link;
                                        }
                                %>
                                    <% if (['audio', 'spotify', 'youtube'].includes(link.type)) { %>
                                        <% 
                                            let mediaId = null;
                                            if (link.type === 'spotify') {
                                                mediaId = extractSpotifyTrackId(link.url);
                                            } else if (link.type === 'youtube') {
                                                mediaId = extractYouTubeVideoId(link.url);
                                            }
                                        %>
                                        <option value="<%= link.id %>" 
                                                data-type="<%= link.type %>" 
                                                data-url="<%= link.url %>"
                                                data-media-id="<%= mediaId || '' %>"
                                                <%= link.id === firstAudioLink?.id ? 'selected' : '' %>>
                                            <%= getLinkDisplayText(link) %>
                                        </option>
                                    <% } %>
                                <% }) %>
                            </select>
                        </div>
                        
                        <!-- Media Player Container -->
                        <div id="mediaPlayerContainer" style="display: none;">
                            <div id="audioPlayer" style="display: none;">
                                <audio controls style="width: 100%; height: 40px;">
                                    <source src="" type="audio/mpeg">
                                    <source src="" type="audio/wav">
                                    <source src="" type="audio/ogg">
                                    <source src="" type="audio/mp4">
                                    Your browser does not support the audio element.
                                </audio>
                            </div>
                            
                            <div id="spotifyPlayer" style="display: none;">
                                <iframe 
                                    src=""
                                    width="100%" 
                                    height="152" 
                                    frameborder="0" 
                                    allowtransparency="true" 
                                    allow="encrypted-media"
                                    style="border-radius: 8px;">
                                </iframe>
                            </div>
                            
                            <div id="youtubePlayer" style="display: none;">
                                <div class="ratio ratio-16x9">
                                    <iframe 
                                        src=""
                                        title="YouTube video player" 
                                        frameborder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                        allowfullscreen>
                                    </iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>

            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Document Info</h6>
                </div>
                <div class="card-body">
                    <p><strong>Type:</strong> <%= getTypeDisplayName(gigDocument.type) %></p>
                    <p><strong>Version:</strong> <%= gigDocument.version %></p>
                    <p><strong>Created:</strong> <%= new Date(gigDocument.createdAt).toLocaleDateString() %></p>
                    <p><strong>Updated:</strong> <%= new Date(gigDocument.updatedAt).toLocaleDateString() %></p>
                    <p><strong>Status:</strong>
                        <% if (gigDocument.isActive) { %>
                            <span class="badge bg-success">Active</span>
                        <% } else { %>
                            <span class="badge bg-secondary">Inactive</span>
                        <% } %>
                    </p>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">Quick Actions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <% if (loggedIn) { %>
                            <% if (gigDocument.createdById === user.id) { %>
                                <a href="/songs/<%= gigDocument.song.id %>/docs/<%= gigDocument.id %>/edit" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-pencil"></i> Edit Content
                                </a>
                            <% } else { %>
                                <a href="/songs/<%= gigDocument.song.id %>/docs/new" class="btn btn-outline-success btn-sm">
                                    <i class="bi bi-plus-circle"></i> Create Your Own
                                </a>
                            <% } %>
                        <% } %>
                        <a href="/songs/<%= gigDocument.song.id %>" class="btn btn-outline-info btn-sm">
                            <i class="bi bi-music-note"></i> View Song
                        </a>
                    </div>
                </div>
            </div>
        </div>
                    </div> <!-- Close left column -->
                </div> <!-- Close row -->
    </div>
</div>

<!-- Quill Better Table CSS for displaying tables -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill-better-table@1.2.10/dist/quill-better-table.min.css">

<style>
    /* Line height styles - allow inline styles to override */
    .gig-document-content p {
        margin: 0.2em 0;
    }

    .gig-document-content {
        /* Allow inline line-height styles to take precedence */
        /* Use same font face as editor */
        font-family: Arial, Helvetica, sans-serif;
    }

    /* Quill indentation classes */
    .ql-indent-1 { margin-left: 2em !important; }
    .ql-indent-2 { margin-left: 4em !important; }
    .ql-indent-3 { margin-left: 6em !important; }
    .ql-indent-4 { margin-left: 8em !important; }
    .ql-indent-5 { margin-left: 10em !important; }
    .ql-indent-6 { margin-left: 12em !important; }
    .ql-indent-7 { margin-left: 14em !important; }
    .ql-indent-8 { margin-left: 16em !important; }

    /* Font weight overrides for gig document content */
    .gig-document-content {
        font-weight: 600 !important; /* Normal text = 600 */
        color: #aaaaaa !important; /* Override any inline color styles */
    }

    .gig-document-content strong,
    .gig-document-content b {
        font-weight: 800 !important; /* Bold text = 800 */
        color: #aaaaaa !important; /* Override any inline color styles on strong/bold elements */
    }

    /* Override inline color styles from TinyMCE editor */
    .gig-document-content * {
        color: #aaaaaa !important;
    }

    /* Quill font family classes */
    .font-serif {
        font-family: "Times New Roman", Times, serif !important;
    }

    .font-sans {
        font-family: Arial, Helvetica, sans-serif !important;
    }

    .font-monospace {
        font-family: "Courier New", Courier, monospace !important;
    }

    @media print {
        .btn-group,
        .col-md-4,
        .d-flex.justify-content-between.align-items-center.mb-4 {
            display: none !important;
        }

        .col-md-8 {
            width: 100% !important;
        }

        .gig-document-content {
            font-size: 12pt;
            line-height: 1.4;
        }

        .card-header {
            background-color: white !important;
            border-bottom: 2px solid #000 !important;
        }

        .card {
            border: 1px solid #000 !important;
            box-shadow: none !important;
        }

        /* Hide the main title and navigation when printing */
        .d-flex.justify-content-between.align-items-center.mb-4 {
            display: none !important;
        }

        /* Ensure the document content is the main focus */
        .gig-document-content {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }

        /* Remove all margins and padding for compact printing */
        body {
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Hide any footer elements that might still appear */
        footer,
        .footer,
        [class*="footer"],
        [class*="copyright"],
        [id*="footer"],
        [id*="copyright"] {
            display: none !important;
        }

        .container {
            margin: 0 !important;
            padding: 0 !important;
            max-width: none !important;
        }

        /* Hide all UI elements */
        .btn-group,
        .col-md-4,
        .d-flex.justify-content-between.align-items-center.mb-4 {
            display: none !important;
        }

        .col-md-8 {
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Remove all card styling and borders */
        .card {
            border: none !important;
            box-shadow: none !important;
            background: white !important;
        }

        .card-header {
            display: none !important;
        }

        .card-body {
            padding: 0 !important;
            margin: 0 !important;
        }

        /* Focus only on the document content */
        .gig-document-content {
            font-size: 11pt !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Remove any remaining spacing */
        .row {
            margin: 0 !important;
        }

        .col-md-8 {
            padding: 0 !important;
        }
    }
</style>

<script>
    // Function to remove copyright elements when printing
    function removeCopyrightElements() {
        // Find and remove any elements containing copyright text
        const elements = document.querySelectorAll('*');
        elements.forEach(element => {
            if (element.textContent && (
                element.textContent.includes('©') ||
                element.textContent.includes('2024 The Band Plan') ||
                element.textContent.includes('Built for musicians')
            )) {
                element.style.display = 'none';
            }
        });
    }

    // Remove copyright elements when print dialog opens
    window.addEventListener('beforeprint', removeCopyrightElements);

    // Also remove them when the print button is clicked
    document.addEventListener('DOMContentLoaded', function () {
        const printButton = document.querySelector('button[onclick="window.print()"]');
        if (printButton) {
            printButton.addEventListener('click', function () {
                setTimeout(removeCopyrightElements, 100);
            });
        }
    });

    // Media Player Functions
    function loadMediaPlayer() {
        const select = document.getElementById('mediaSelect');
        const container = document.getElementById('mediaPlayerContainer');
        
        // Hide all players first
        document.getElementById('audioPlayer').style.display = 'none';
        document.getElementById('spotifyPlayer').style.display = 'none';
        document.getElementById('youtubePlayer').style.display = 'none';
        
        if (select.value) {
            const option = select.options[select.selectedIndex];
            const type = option.dataset.type;
            const url = option.dataset.url;
            const mediaId = option.dataset.mediaId;
            
            container.style.display = 'block';
            
            if (type === 'audio') {
                const audioPlayer = document.getElementById('audioPlayer');
                const audio = audioPlayer.querySelector('audio');
                audio.src = url;
                audioPlayer.style.display = 'block';
                
            } else if (type === 'spotify' && mediaId) {
                const spotifyPlayer = document.getElementById('spotifyPlayer');
                const iframe = spotifyPlayer.querySelector('iframe');
                iframe.src = `https://open.spotify.com/embed/track/${mediaId}`;
                spotifyPlayer.style.display = 'block';
                
            } else if (type === 'youtube' && mediaId) {
                const youtubePlayer = document.getElementById('youtubePlayer');
                const iframe = youtubePlayer.querySelector('iframe');
                iframe.src = `https://www.youtube.com/embed/${mediaId}`;
                youtubePlayer.style.display = 'block';
            }
        } else {
            container.style.display = 'none';
        }
    }

    // Auto-load preselected audio on page load
    document.addEventListener('DOMContentLoaded', function() {
        const select = document.getElementById('mediaSelect');
        if (select && select.selectedIndex > 0) {
            // Load the preselected option (most recent audio)
            loadMediaPlayer();
        }
    });
</script>